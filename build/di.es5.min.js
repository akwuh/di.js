!function(n,e){if("function"==typeof define&&define.amd)define("di",["exports","lodash"],e);else if("undefined"!=typeof exports)e(exports,require("lodash"));else{var r={exports:{}};e(r.exports,n.lodash),n.di=r.exports}}(this,function(n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function n(n,e){var r=[],t=!0,i=!1,o=void 0;try{for(var u,s=n[Symbol.iterator]();!(t=(u=s.next()).done)&&(r.push(u.value),!e||r.length!==e);t=!0);}catch(n){i=!0,o=n}finally{try{!t&&s.return&&s.return()}finally{if(i)throw o}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return n(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),t=e.extend,i=e.defaults,o=e.uniqueId,u=e.values,s=e.omit,c=e.isArray,f=e.isObject,a=e.isFunction,d=e.forEach,l=e.filter,v=e.map,p=function(n,e){return n&&n.then?n.then(e):e(n)},h=function(n,e){var r=n.some(function(n){return!(!n||!n.then)});return r?Promise.all(n).then(e):e(n)},m=function(n,e){return n&&n.catch&&n.catch(e),n},g=function(n){var e={},r=function(n){n.keys().forEach(function(r){var t=r.match(/\/([^\/]+)$/)[1];e[t]||(e[t]=function(){return n(r)})})};return n.forEach(r),function(n){n.match(/\.js$/)||(n+=".js");var r=e[n],t=void 0;if(r){if(t=r(),"function"==typeof t&&!t.name){if(1===t.length)return new Promise(function(n){t(n)});if(0===t.length)return t()}return t}}},y=function(n){return function(e){return n[e]}},w=function(n){var e={};return function(r){var t=n.slice();if(e[r])return e[r];var i=function n(){if(t.length){var i=t.shift();return p(i(r),function(t){return t?e[r]=t:n()})}};return e[r]=i()}},b=function(n){var e=n?n.match(/^([^.]+)(\.(.+))?$/):null;if(!e)throw Error("Unknown module format: "+JSON.stringify(n));return{bundleName:e[1],factory:e[3]}},S=function(n,e){var r={id:n};if("string"==typeof e)t(r,b(e));else if(c(e))1===e.length?(r.id=o("di"),t(r,e[0])):t(r,b(e[0]),{dependencies:e[1]});else{if(!f(e))throw Error("Unknown type of dependency definition");t(r,b(n),{dependencies:e})}return i(r,{factory:"factory",dependencies:{}})},_=function n(e,r){d(e.dependencies,function(t,i){if("object"!=typeof t||c(t)||(t=[i,t]),c(t)){var u=S(o(e.id+"/"+i),t);r[u.id]=u,e.dependencies[i]=u.id,n(u,r)}})},E=function(n){var e={};return d(n,function(n,r){e[r]=S(r,n)}),d(e,function(n){_(n,e)}),e},I=function(n){return n.__esModule===!0?u(s(n,"__esModule"))[0]:n},x=function(n,e){var r=n.Module,t=n.factory;return r=I(r),r[t]?r[t](e):new r(e)},D=function(){var n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=n.resolvers,i=void 0===e?[]:e,u=n.dependencies,s=void 0===u?{}:u,c=E(s),f=w(i),m=function(n){return n.Module?n.Module:p(f(n.bundleName),function(e){return e?(n.Module=e,e):Promise.reject(Error('Cannot find bundle with name "'+n.bundleName+'"'))})},g=function(n){if("string"==typeof n)return c[n]?c[n]:c[n]=S(n,{});throw console.log("UNKNOWN MODULE",n),Error("Unknown module")},y=function(n,e){var t=g(n),i=function(){var n=[_(t,e),t.instance?null:m(t)];return h(n,function(n){var i=r(n,1),o=i[0],u=function(){return t.instance?t.instance:x(t,o)};return p(u(),function(n){var r=!e.diSessionId||t.diSessionId!==e.diSessionId;return t.diSessionId=e.diSessionId,a(n.updateDependencies)&&r?p(n.updateDependencies(o),function(){return n}):n})})};return t._progress?t._progress:(t._progress=p(i(),function(n){return t.instance=n,n}),p(t._progress,function(n){return t._progress=null,n}))},b=function(n,e){var r=t({},e);if(n){var i=v(n,function(n,t){return p(y(n,e),function(n){return r[t]=n})});return h(i,function(){return r})}return r},_=function(n,e){return b(n.dependencies,e)},D=function(n){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=void 0;return r="string"==typeof n?y(n,e):b(n,e)};return D.session=function(){var n=o("di");return{load:function(e){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return r.diSessionId=n,D(e,r)},close:function(){d(c,function(e){var r=e.instance;!e.isPersistent&&e.diSessionId&&e.diSessionId!==n&&r&&(r.trigger&&r.trigger("di:destroy"),a(r.destroy)&&r.destroy(),e.instance=null)})}}},D.put=function(n,e){var r=g(n);return r.instance=e,void(r.isPersistent=!0)},D.serialize=function(){var n={},e=l(c,function(n){var e=n.instance;return e&&a(e.serialize)}),r=v(e,function(e){var r=e.id,t=e.instance;return p(t.serialize(),function(e){return n[r]=e})});return h(r,function(){return n})},D.restore=function(n){var e=v(n,function(n,e){var r=g(e);return p(m(r),function(e){if(e=I(e),!e.restore)throw Error("Cannot restore module");return p(e.restore(n),function(n){return r.instance=n})})});return h(e,function(n){return n})},D};n.createContainer=D,n.webpackResolver=g,n.staticResolver=y,n.arrayResolver=w,n.then=p,n.all=h,n.qCatch=m,n.normalizeDefinitionDependencies=_,n.parseStringDefinition=b,n.normalizeDefinitions=E,n.normalizeDefinition=S,n.factory=x});