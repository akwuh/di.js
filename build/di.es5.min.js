!function(n,e){if("function"==typeof define&&define.amd)define("di",["exports","lodash"],e);else if("undefined"!=typeof exports)e(exports,require("lodash"));else{var r={exports:{}};e(r.exports,n.lodash),n.di=r.exports}}(this,function(n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function n(n,e){var r=[],t=!0,i=!1,o=void 0;try{for(var u,s=n[Symbol.iterator]();!(t=(u=s.next()).done)&&(r.push(u.value),!e||r.length!==e);t=!0);}catch(n){i=!0,o=n}finally{try{!t&&s.return&&s.return()}finally{if(i)throw o}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return n(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),t=function(n,e){return n&&n.then?n.then(e):e(n)},i=function(n,e){var r=n.some(function(n){return!(!n||!n.then)});return r?Promise.all(n).then(e):e(n)},o=function(n,e){return n&&n.catch&&n.catch(e),n},u=function(n){var e={},r=function(n){n.keys().forEach(function(r){var t=r.match(/\/([^\/]+)$/)[1];e[t]||(e[t]=function(){return n(r)})})};return n.forEach(r),function(n){n.match(/\.js$/)||(n+=".js");var r=e[n],t=void 0;return r?(t=r(),"function"!=typeof t||t.name?t:new Promise(function(n){t(n)})):void 0}},s=function(n){return function(e){return n[e]}},c=function(n){var e={};return function(r){var i=n.slice();if(e[r])return e[r];var o=function n(){if(i.length){var o=i.shift();return t(o(r),function(t){return t?e[r]=t:n()})}};return e[r]=o()}},a=function(n){var e=n?n.match(/^([^.]+)(\.(.+))?$/):null;if(!e)throw Error("Unknown module format: "+JSON.stringify(n));return{bundleName:e[1],factory:e[3]}},f=function(n,r){var t={id:n};if("string"==typeof r)e.extend(t,a(r));else if(e.isArray(r))1===r.length?(t.id=e.uniqueId("di"),e.extend(t,r[0])):e.extend(t,a(r[0]),{dependencies:r[1]});else{if(!e.isObject(r))throw Error("Unknown type of dependency definition");e.extend(t,a(n),{dependencies:r})}return e.defaults(t,{factory:"factory",dependencies:{}})},d=function n(r,t){e.forEach(r.dependencies,function(i,o){if("object"!=typeof i||e.isArray(i)||(i=[o,i]),e.isArray(i)){var u=f(e.uniqueId(r.id+"/"+o),i);t[u.id]=u,r.dependencies[o]=u.id,n(u,t)}})},l=function(n){var r={};return e.forEach(n,function(n,e){r[e]=f(e,n)}),e.forEach(r,function(n){d(n,r)}),r},v=function(n,r){var t=n.Module,i=n.factory;return t.__esModule===!0&&(t=e.values(t)[0]),t[i]?t[i](r):new t(r)},p=function(){var n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],o=n.resolvers,u=void 0===o?[]:o,s=n.dependencies,a=void 0===s?{}:s,d=l(a),p=c(u),h=function(n){return n.Module?n.Module:t(p(n.bundleName),function(e){return e?(n.Module=e,e):Promise.reject(Error('Cannot find bundle with name "'+n.bundleName+'"'))})},y=function(n){if("string"==typeof n)return d[n]?d[n]:d[n]=f(n,{});throw console.log("UNKNOWN MODULE",n),Error("Unknown module")},m=function(n,o){var u=y(n),s=function(){var n=[w(u,o),u.instance?null:h(u)];return i(n,function(n){var i=r(n,1),s=i[0],c=function(){return u.instance?u.instance:v(u,s)};return t(c(),function(n){var r=!o.diSessionId||u.diSessionId!==o.diSessionId;return u.diSessionId=o.diSessionId,e.isFunction(n.updateDependencies)&&r?t(n.updateDependencies(s),function(){return n}):n})})};return u._progress?u._progress:(u._progress=t(s(),function(n){return u.instance=n,n}),t(u._progress,function(n){return u._progress=null,n}))},g=function(n,r){var o=e.extend({},r);if(n){var u=e.map(n,function(n,e){return t(m(n,r),function(n){return o[e]=n})});return i(u,function(){return o})}return o},w=function(n,e){return g(n.dependencies,e)},b=function(n){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=void 0;return r="string"==typeof n?m(n,e):g(n,e)};return b.session=function(){var n=e.uniqueId("di");return{load:function(e){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return r.diSessionId=n,b(e,r)},close:function(){e.forEach(d,function(r){var t=r.instance;!r.isPersistent&&r.diSessionId&&r.diSessionId!==n&&t&&(t.trigger&&t.trigger("di:destroy"),e.isFunction(t.destroy)&&t.destroy(),r.instance=null)})}}},b.put=function(n,e){var r=y(n);return r.instance=e,void(r.isPersistent=!0)},b};n.createContainer=p,n.webpackResolver=u,n.staticResolver=s,n.arrayResolver=c,n.then=t,n.all=i,n.qCatch=o,n.normalizeDefinitionDependencies=d,n.parseStringDefinition=a,n.normalizeDefinitions=l,n.normalizeDefinition=f,n.factory=v});