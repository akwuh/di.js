!function(n,e){if("function"==typeof define&&define.amd)define("di",["exports","lodash"],e);else if("undefined"!=typeof exports)e(exports,require("lodash"));else{var r={exports:{}};e(r.exports,n.lodash),n.di=r.exports}}(this,function(n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function n(n,e){var r=[],t=!0,i=!1,o=void 0;try{for(var u,s=n[Symbol.iterator]();!(t=(u=s.next()).done)&&(r.push(u.value),!e||r.length!==e);t=!0);}catch(n){i=!0,o=n}finally{try{!t&&s.return&&s.return()}finally{if(i)throw o}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return n(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),t=e.extend,i=e.functions,o=e.defaults,u=e.uniqueId,s=e.values,a=e.omit,c=e.isArray,f=e.isObject,d=e.isFunction,l=e.forEach,v=e.filter,p=e.map,g=function(n,e){if(n&&n.then)return n.then(e);try{return e(n)}catch(n){return Promise.reject(n)}},h=function(n,e){var r=n.some(function(n){return!(!n||!n.then)});if(r)return Promise.all(n).then(e);try{return e(n)}catch(n){return Promise.reject(n)}},m=function(n,e){return n&&n.catch&&n.catch(e),n},y=function(n){var e={},r=function(n){n.keys().forEach(function(r){var t=r.match(/\/([^\/]+)$/)[1];e[t]||(e[t]=function(){return n(r)})})};return n.forEach(r),function(n){n.match(/\.js$/)||(n+=".js");var r=e[n],t=void 0;if(r){if(t=r(),"function"==typeof t&&!t.name){if(1===t.length)return new Promise(function(n){t(n)});if(0===t.length)return t()}return t}}},w=function(n){return function(e){return n[e]}},b=function(n){var e={};return function(r){var t=n.slice();if(e[r])return e[r];var i=function n(){if(t.length){var i=t.shift();return g(i(r),function(t){return t?e[r]=t:n()})}};return e[r]=i()}},S=function(n){var e=n?n.match(/^([^.]+)(\.(.+))?$/):null;if(!e)throw Error("Unknown module format: "+JSON.stringify(n));return{bundleName:e[1],factory:e[3]}},E=function(n,e){var r={id:n};if("string"==typeof e)t(r,S(e));else if(c(e))1===e.length?(r.id=u("di"),t(r,e[0])):t(r,S(e[0]),{dependencies:e[1]});else{if(!f(e))throw Error("Unknown type of dependency definition");t(r,S(n),{dependencies:e})}return o(r,{factory:"factory",dependencies:{}})},_=function n(e,r){l(e.dependencies,function(t,i){if("object"!=typeof t||c(t)||(t=[i,t]),c(t)){var o=E(u(e.id+"/"+i),t);r[o.id]=o,e.dependencies[i]=o.id,n(o,r)}})},D=function(n){var e={};return l(n,function(n,r){e[r]=E(r,n)}),l(e,function(n){_(n,e)}),e},I=function(n){return n.__esModule===!0?s(a(n,"__esModule"))[0]:n},M=function(n,e){var r=n.Module,t=n.factory;return r=I(r),r[t]?r[t](e):new r(e)},j=function(){var n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=n.resolvers,o=void 0===e?[]:e,s=n.dependencies,a=void 0===s?{}:s,c=D(a),f=b(o),m=function(n){return n.Module?n.Module:g(f(n.bundleName),function(e){return e?(n.Module=e,e):Promise.reject(Error('Cannot find bundle with name "'+n.bundleName+'"'))})},y=function(n){if("string"==typeof n)return c[n]?c[n]:c[n]=E(n,{});throw console.log("UNKNOWN MODULE",n),Error("Unknown module")},w=function(n,e){var t=y(n),i=function(){var n=[_(t,e),t.instance?null:m(t)];return h(n,function(n){var i=r(n,1),o=i[0],u=function(){return t.instance?t.instance:M(t,o)};return g(u(),function(n){var r=!e.diSessionId||t.diSessionId!==e.diSessionId;return t.diSessionId=e.diSessionId,d(n.updateDependencies)&&r?g(n.updateDependencies(o),function(e){return n}):n})})};return t._progress?t._progress:(t._progress=g(i(),function(n){return t.instance=n,n}),g(t._progress,function(n){return t._progress=null,n}))},S=function(n,e){var r=t({},e);if(n){var i=p(n,function(n,t){return g(w(n,e),function(n){return r[t]=n})});return h(i,function(n){return r})}return r},_=function(n,e){return S(n.dependencies,e)},j=function(n){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=void 0;return r="string"==typeof n?w(n,e):S(n,e)};return j.session=function(){var n=u("di"),e=function(e){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return r.diSessionId=n,j(e,r)};return e.load=e,e.close=function(){l(c,function(e){var r=e.instance;!e.isPersistent&&e.diSessionId&&e.diSessionId!==n&&r&&(r.trigger&&r.trigger("di:destroy"),d(r.destroy)&&r.destroy(),e.instance=null)})},i(j).forEach(function(n){e[n]=j[n]}),e},j.put=function(n,e,r){var i=y(n);t(i,{instance:e,isPersistent:!0},r)},j.serialize=function(){for(var n=arguments.length,e=Array(n),r=0;n>r;r++)e[r]=arguments[r];var t={},i=v(c,function(n){var e=n.instance;return e&&d(e.serialize)}),o=p(i,function(n){var r=n.id,i=n.instance;return g(i.serialize.apply(i,e),function(n){return t[r]=n})});return h(o,function(){return t})},j.restore=function(n){for(var e=arguments.length,r=Array(e>1?e-1:0),t=1;e>t;t++)r[t-1]=arguments[t];var i=p(n,function(n,e){return j.restoreModule.apply(j,[e,n].concat(r))});return h(i,function(n){return n})},j.restoreModule=function(n){for(var e=arguments.length,r=Array(e>1?e-1:0),t=1;e>t;t++)r[t-1]=arguments[t];var i=y(n);return g(m(i),function(n){var e;if(n=I(n),!n.restore)throw Error("Cannot restore module");return g((e=n).restore.apply(e,r),function(n){return i.instance=n})})},j.getDefinitions=function(){return c},j.getDefinition=function(n){return y(n)},j};n.createContainer=j,n.webpackResolver=y,n.staticResolver=w,n.arrayResolver=b,n.then=g,n.all=h,n.qCatch=m,n.normalizeDefinitionDependencies=_,n.parseStringDefinition=S,n.normalizeDefinitions=D,n.normalizeDefinition=E,n.factory=M});
